#!/bin/bash
# bin/compile BUILD_DIR CACHE_DIR ENV_DIR

set -u # stop on unset variables
set -e # stop on error

indent() {
  sed -u 's/^/       /'
}

function topic() {
  echo "-----> $*"
}

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

TESTSSL_VERSION="3.0.7"
TESTSSL_URL="https://github.com/drwetter/testssl.sh/raw/v${TESTSSL_VERSION}/testssl.sh"
TESTSSL_BASE_PATH="$BUILD_DIR/bin"
TESTSSL_PATH="$TESTSSL_BASE_PATH/testssl.sh"

mkdir -p "$TESTSSL_BASE_PATH"

topic "Installing testssl.sh v$TESTSSL_VERSION"
echo "Downloading $TESTSSL_URL" | indent
curl --silent --retry 5 --location $TESTSSL_URL --output $TESTSSL_PATH
chmod u+x $TESTSSL_PATH

topic "Testing testssl.sh v$TESTSSL_VERSION"
WARNINGS=off $TESTSSL_PATH --version
